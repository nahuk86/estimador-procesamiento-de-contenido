<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estimador de Tiempos - Adaptación de eLearning</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
</head>
<body class="bg-gray-100 p-8">
<div class="bg-white p-6 rounded-2xl shadow-2xl max-w-3xl mx-auto">
    <h2 class="text-2xl font-bold mb-6">Estimación Detallada de Tiempo</h2>
    <div class="space-y-4">
        <div>
            <label class="block font-medium mb-1">Número de Learning Paths:</label>
            <input id="numPaths" type="number" min="1" value="1" class="p-2 border rounded w-full" onchange="renderPaths()">
        </div>
        <form id="estimacionForm" class="space-y-6"></form>
        <button onclick="calcular()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full font-bold">Calcular Tiempo Total</button>
        <div id="resultado" class="mt-6 text-lg font-semibold text-blue-800"></div>
    </div>
</div>
<script>
function renderPaths() {
    const container = document.getElementById('estimacionForm');
    container.innerHTML = '';
    const numPaths = parseInt(document.getElementById('numPaths').value) || 1;
    for (let p = 1; p <= numPaths; p++) {
        const pathDiv = document.createElement('div');
        pathDiv.className = 'p-4 border rounded space-y-3';
        pathDiv.innerHTML = `
            <h3 class="font-semibold">Learning Path ${p}</h3>
            <div>
                <label class="block mb-1">Módulos:</label>
                <input type="number" min="1" value="1" class="p-1 border rounded w-full modules-count" onchange="renderModules(this, ${p-1})">
            </div>
            <div class="modules-container space-y-4" data-path-index="${p-1}"></div>
        `;
        container.appendChild(pathDiv);
        // Render default modules
        renderModules(pathDiv.querySelector('.modules-count'), p-1);
    }
}

function renderModules(input, pathIndex) {
    const modulesContainer = input.closest('div').nextElementSibling;
    modulesContainer.innerHTML = '';
    const numMod = parseInt(input.value) || 1;
    for (let m = 1; m <= numMod; m++) {
        const moduleDiv = document.createElement('div');
        moduleDiv.className = 'p-3 border rounded bg-gray-50';
        moduleDiv.innerHTML = `
            <h4 class="font-medium">Módulo ${m}</h4>
            <div>
                <label class="block mb-1">Actividades:</label>
                <input type="number" min="1" value="1" class="p-1 border rounded w-full activities-count" onchange="renderActivities(this, ${pathIndex}, ${m-1})">
            </div>
            <div class="activities-container space-y-2" data-module-index="${m-1}" data-path-index="${pathIndex}"></div>
        `;
        modulesContainer.appendChild(moduleDiv);
        renderActivities(moduleDiv.querySelector('.activities-count'), pathIndex, m-1);
    }
}

function renderActivities(input, pathIndex, moduleIndex) {
    const activitiesContainer = input.closest('div').nextElementSibling;
    activitiesContainer.innerHTML = '';
    const numAct = parseInt(input.value) || 1;
    for (let a = 1; a <= numAct; a++) {
        const actDiv = document.createElement('div');
        actDiv.className = 'p-2 border rounded bg-white';
        actDiv.innerHTML = `
            <h5>Actividad ${a}</h5>
            <div class="grid grid-cols-1 gap-2">
                <select class="p-1 border rounded content-type">
                    <option value="scorm">SCORM</option>
                    <option value="h5p">H5P</option>
                    <option value="ppt">PowerPoint</option>
                    <option value="video">Video</option>
                    <option value="pdf">PDF</option>
                    <option value="texto">Texto</option>
                    <option value="otro">Otro</option>
                </select>
                <div class="grid grid-cols-2 gap-1 adaptations">
                    <label><input type="checkbox" class="mr-1 adaptation" value="conversion">Conversión</label>
                    <label><input type="checkbox" class="mr-1 adaptation" value="edicion">Edición multimedia</label>
                    <label><input type="checkbox" class="mr-1 adaptation" value="navegacion">Navegación</label>
                    <label><input type="checkbox" class="mr-1 adaptation" value="correccion">Corrección</label>
                    <label><input type="checkbox" class="mr-1 adaptation" value="accesibilidad">Accesibilidad</label>
                    <label><input type="checkbox" class="mr-1 adaptation" value="multilingue">Multilingüe</label>
                    <label><input type="checkbox" class="mr-1 adaptation" value="integracion">Integración</label>
                </div>
            </div>
        `;
        activitiesContainer.appendChild(actDiv);
    }
}

function calcular() {
    const resultEl = document.getElementById('resultado');
    let tiempoTotal = 0;
    document.querySelectorAll('[data-path-index]').forEach(pathDiv => {
        const pathIndex = pathDiv.getAttribute('data-path-index');
        pathDiv.querySelectorAll('.modules-container > div').forEach((modDiv, mIdx) => {
            modDiv.querySelectorAll('.activities-container > div').forEach((actDiv) => {
                const tipo = actDiv.querySelector('.content-type').value;
                const adaptChecks = Array.from(actDiv.querySelectorAll('.adaptation')).filter(c => c.checked).map(c => c.value);
                // Asignar tier
                let tier = 1;
                if (adaptChecks.includes('accesibilidad') || adaptChecks.includes('integracion') || adaptChecks.includes('multilingue') || adaptChecks.length >= 3) tier = 3;
                else if (adaptChecks.length >= 1) tier = 2;
                // Tiempo base por tier y tipo (días hábiles)
                const base = {scorm:1, h5p:1, ppt:0.5, video:0.5, pdf:0.3, texto:0.2, otro:0.5}[tipo] || 0.5;
                const factorTier = [1,2,3][tier-1];
                tiempoTotal += base * factorTier;
            });
        });
    });
    resultEl.innerHTML = `Tiempo estimado total: <b>${tiempoTotal.toFixed(1)}</b> días hábiles.`;
}

document.addEventListener('DOMContentLoaded', renderPaths);
</script>
</body>
</html>
